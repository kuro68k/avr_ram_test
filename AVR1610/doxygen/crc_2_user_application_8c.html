<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Xmega IEC60730 Class B Library: UserApplication.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="XMEGA-3D-block-diagram.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xmega IEC60730 Class B Library
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('crc_2_user_application_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">crc/UserApplication.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Demo application for the CRC tests. </p>
<p>This is an example that shows how the Flash and EEPROM CRC tests can be embedded in an user application. The CRC checksums of the Flash and a data section in EEPROM are pre-calculated and stored in EEPROM. During normal execution an LED is lighted while the system runs without errors. Pressing a button leads to CRC test of the Flash and the data section in EEPROM: new checksums are computed and compared with the ones stored in EEPROM. If any of the pairs were different, the error flag would be set (within the test) and the LED would be switched off. This can be tested for example by declaring the symbols <a class="el" href="crc_2_user_application_8c.html#a8df009ca9b5be5277cb19b17a97714e4">MODIFY_FLASH</a> and <a class="el" href="crc_2_user_application_8c.html#ab84d5a515a2fb4e43bc7c01b1250e72f">MODIFY_EEPROM</a>.</p>
<p>Note that if the program is modified, the stored CRC needs to be computed again since the content in Flash will change. This can be done by debugging the program and placing a watch on the following variables:</p>
<ul>
<li><code>checksum_test_flash</code> </li>
<li><code>checksum_test_eeprom</code> </li>
</ul>
<p>Those values can be assigned then to</p>
<ul>
<li><a class="el" href="crc_2_user_application_8c.html#a98aaac8e3fe2e1673288a6413d5ff19e">classb_precalculated_flash_crc</a></li>
<li><a class="el" href="crc_2_user_application_8c.html#a5bdee35b378ca760b13252610b9cef06">classb_precalculated_eeprom_crc</a></li>
</ul>
<dl class="section user"><dt>Application note:</dt><dd>AVR1610: Guide to IEC60730 Class B compliance with XMEGA</dd></dl>
<dl class="section user"><dt>Documentation</dt><dd>For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.html</dd></dl>
<dl class="section author"><dt>Author:</dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br/>
 Support email: <a href="#" onclick="location.href='mai'+'lto:'+'avr'+'@a'+'tme'+'l.'+'com'; return false;">avr@a<span style="display: none;">.nosp@m.</span>tmel<span style="display: none;">.nosp@m.</span>.com</a></dd></dl>
<p>Copyright (C) 2012 Atmel Corporation. All rights reserved. </p>

<p>Definition in file <a class="el" href="crc_2_user_application_8c_source.html">crc/UserApplication.c</a>.</p>
</div><div class="textblock"><code>#include &quot;<a class="el" href="avr__compiler_8h_source.html">avr_compiler.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="classb__crc_8h_source.html">classb_crc.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for crc/UserApplication.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="crc_2_user_application_8c__incl.png" border="0" usemap="#_user_application_8c" alt=""/></div>
<map name="_user_application_8c" id="_user_application_8c">
<area shape="rect" id="node3" href="avr__compiler_8h.html" title="Header file for compiler compatibility." alt="" coords="79,229,184,256"/><area shape="rect" id="node11" href="classb__crc_8h.html" title="Settings and defines used in connection with CRC memory tests." alt="" coords="221,80,317,107"/><area shape="rect" id="node14" href="error__handler_8h.html" title="Macros and definitions for handling errors and other configurable actions." alt="" coords="78,155,185,181"/><area shape="rect" id="node17" href="classb__crc__hw_8h.html" title="Definitions and settings for the CRC hardware module driver." alt="" coords="210,155,328,181"/><area shape="rect" id="node21" href="classb__crc__sw_8h.html" title="Definitions and settings for the CRC implemented in software." alt="" coords="353,155,471,181"/></map>
</div>
</div>
<p><a href="crc_2_user_application_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8df009ca9b5be5277cb19b17a97714e4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#a8df009ca9b5be5277cb19b17a97714e4">MODIFY_FLASH</a></td></tr>
<tr class="memdesc:a8df009ca9b5be5277cb19b17a97714e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">If declared the content of the flash is modified.  <a href="#a8df009ca9b5be5277cb19b17a97714e4"></a><br/></td></tr>
<tr class="memitem:ab84d5a515a2fb4e43bc7c01b1250e72f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#ab84d5a515a2fb4e43bc7c01b1250e72f">MODIFY_EEPROM</a></td></tr>
<tr class="memdesc:ab84d5a515a2fb4e43bc7c01b1250e72f"><td class="mdescLeft">&#160;</td><td class="mdescRight">If declared the content of the EEPROM data section is modified.  <a href="#ab84d5a515a2fb4e43bc7c01b1250e72f"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acb02f74d7428c74f749f228dec34d426"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acb02f74d7428c74f749f228dec34d426"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#acb02f74d7428c74f749f228dec34d426">setup_led_switches</a> ()</td></tr>
<tr class="memdesc:acb02f74d7428c74f749f228dec34d426"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function sets up the LED and switch. The LED is switched on to show that the system is working correctly. The switch is configured to generate an interrupt after being pressed. <br/></td></tr>
<tr class="memitem:a86f0b9f76fc4c82102c20a9ed081190a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#a86f0b9f76fc4c82102c20a9ed081190a">ISR</a> (SWITCH_INT0_vect)</td></tr>
<tr class="memdesc:a86f0b9f76fc4c82102c20a9ed081190a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for button press.  <a href="#a86f0b9f76fc4c82102c20a9ed081190a"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a98aaac8e3fe2e1673288a6413d5ff19e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a98aaac8e3fe2e1673288a6413d5ff19e"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#a98aaac8e3fe2e1673288a6413d5ff19e">classb_precalculated_flash_crc</a> = 0xe7138241</td></tr>
<tr class="memdesc:a98aaac8e3fe2e1673288a6413d5ff19e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This variable contains the CRC checksum for the flash and is stored in EEPROM. <br/></td></tr>
<tr class="memitem:a5bdee35b378ca760b13252610b9cef06"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5bdee35b378ca760b13252610b9cef06"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#a5bdee35b378ca760b13252610b9cef06">classb_precalculated_eeprom_crc</a> = 0xcd4b</td></tr>
<tr class="memdesc:a5bdee35b378ca760b13252610b9cef06"><td class="mdescLeft">&#160;</td><td class="mdescRight">This variable contains the CRC checksum for the data section in EEPROM. It is stored in EEPROM. <br/></td></tr>
<tr class="memitem:aac285bde071b1c47ca03a02bc1bf6d91"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aac285bde071b1c47ca03a02bc1bf6d91"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="crc_2_user_application_8c.html#aac285bde071b1c47ca03a02bc1bf6d91">data_eeprom</a> [] = {0,1,2,3,4,5,6,7,8,9,10}</td></tr>
<tr class="memdesc:aac285bde071b1c47ca03a02bc1bf6d91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data stored in EEPROM. <br/></td></tr>
<tr class="memitem:gabd8069526e5340f2e8f831627ec6857c"><td class="memItemLeft" align="right" valign="top">NO_INIT volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__error__handler.html#gabd8069526e5340f2e8f831627ec6857c">classb_error</a></td></tr>
<tr class="memdesc:gabd8069526e5340f2e8f831627ec6857c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Global error flag.  <a href="group__error__handler.html#gabd8069526e5340f2e8f831627ec6857c"></a><br/></td></tr>
</table>
<hr/><h2>Macro Definition Documentation</h2>
<a class="anchor" id="a8df009ca9b5be5277cb19b17a97714e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MODIFY_FLASH</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If declared the content of the flash is modified. </p>
<p>If declared an endless loop is compiled at the end of the main application. This changes the program code and thus the flash content. The previously stored checksum will then be different than the new one. </p>

<p>Definition at line <a class="el" href="crc_2_user_application_8c_source.html#l00083">83</a> of file <a class="el" href="crc_2_user_application_8c_source.html">crc/UserApplication.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab84d5a515a2fb4e43bc7c01b1250e72f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MODIFY_EEPROM</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If declared the content of the EEPROM data section is modified. </p>
<p>If declared an endless loop is compiled at the end of the main application. This changes the program code and thus the flash content. The previously stored checksum will then be different than the new one. </p>

<p>Definition at line <a class="el" href="crc_2_user_application_8c_source.html#l00094">94</a> of file <a class="el" href="crc_2_user_application_8c_source.html">crc/UserApplication.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a86f0b9f76fc4c82102c20a9ed081190a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">SWITCH_INT0_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for button press. </p>
<p>This will compute the checksums of the Flash and data section in EEPROM and compare them with the ones stored in EEPROM. There some code lines that could be uncommented in order to check the other CRC implementations. </p>

<p>Definition at line <a class="el" href="crc_2_user_application_8c_source.html#l00188">188</a> of file <a class="el" href="crc_2_user_application_8c_source.html">crc/UserApplication.c</a>.</p>

<p>References <a class="el" href="classb__crc__hw_8c_source.html#l00394">CLASSB_CRC16_EEPROM_HW()</a>, <a class="el" href="classb__crc__hw_8c_source.html#l00560">CLASSB_CRC32_Flash_HW()</a>, <a class="el" href="crc_2_user_application_8c_source.html#l00142">classb_precalculated_eeprom_crc</a>, <a class="el" href="crc_2_user_application_8c_source.html#l00136">classb_precalculated_flash_crc</a>, <a class="el" href="classb__crc__hw_8h_source.html#l00083">CRC_APP</a>, and <a class="el" href="crc_2_user_application_8c_source.html#l00146">data_eeprom</a>.</p>

<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="crc_2_user_application_8c_a86f0b9f76fc4c82102c20a9ed081190a_cgraph.png" border="0" usemap="#crc_2_user_application_8c_a86f0b9f76fc4c82102c20a9ed081190a_cgraph" alt=""/></div>
<map name="crc_2_user_application_8c_a86f0b9f76fc4c82102c20a9ed081190a_cgraph" id="crc_2_user_application_8c_a86f0b9f76fc4c82102c20a9ed081190a_cgraph">
<area shape="rect" id="node3" href="group__classb__crc__hw.html#ga223f015bbb64f08ad0e5759a26d2eb6e" title="Compute 16&#45;bit CRC for EEPROM address range using hardware CRC module." alt="" coords="97,5,311,32"/><area shape="rect" id="node5" href="group__classb__crc__hw.html#gab9c4362c4f3c100edbab049d5ca5cef1" title="Compute 32&#45;bit CRC for Flash address range using hardware CRC module." alt="" coords="109,56,299,83"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li><li class="navelem"><a class="el" href="dir_d74567785969f95ee8e4e67a8564aa73.html">crc</a></li><li class="navelem"><a class="el" href="crc_2_user_application_8c.html">UserApplication.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
