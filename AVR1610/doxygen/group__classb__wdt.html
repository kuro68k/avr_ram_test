<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Xmega IEC60730 Class B Library: Watchdog Timer Test</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="XMEGA-3D-block-diagram.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xmega IEC60730 Class B Library
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__classb__wdt.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Watchdog Timer Test</div>  </div>
</div><!--header-->
<div class="contents">
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>This test checks that the watchdog timer (WDT) is working. The WDT is a system function for monitoring correct program operation that allows recovering from error situations such as runaway or deadlocked code. The self-diagnostic test <a class="el" href="group__classb__wdt.html#ga802c2e3817ea15aec36a0930dc3dbe4f">classb_wdt_test()</a> is executed before the main application and it basically makes sure that: </p>
<ul>
<li>a system reset is issued after WDT timeout</li>
<li>the WDT can be reset</li>
<li>the device is reset upon untimely WDT reset in window mode</li>
</ul>
<p>The test relies on the Real Time Counter (RTC) to check the timing of the WDT oscillator and, therefore, this library includes a basic RTC driver (see <a class="el" href="group__rtc__driver.html">Real Time Counter Driver</a>). Note that the RTC has a clock source independent from the CPU and the WDT. The RTC module is implicitly tested as well: if the frequency difference between RTC and WDT is more than 50%, the error state is set.</p>
<p>Errors are handled by <a class="el" href="group__error__handler.html#ga7116805ebcadd937b4da657c8928514c">CLASSB_ERROR_HANDLER_WDT()</a> and there are two configurable actions:</p>
<ol type="1">
<li><a class="el" href="group__error__handler.html#gafc91494ced509f11776b833ca6176730">CLASSB_ACTIONS_WDT_RUNTIME_FAILURE()</a> processes systems resets caused by a working WDT.</li>
<li><a class="el" href="group__error__handler.html#gab5e1e551d29d6d8e3d436fea0e2b51f2">CLASSB_ACTIONS_WDT_OTHER_FAILURE()</a> deals with other reset causes, e.g. brown-out or software reset.</li>
</ol>
<p>In addition to error handler and configurable actions, the user should configure the WDT periods <a class="el" href="group__classb__wdt.html#ga161d302a8184a4b2f06283e415a28c5d">CLASSB_WDT_WPER</a> and <a class="el" href="group__classb__wdt.html#gaf28ab763bb273114496098b3fa2b5fa5">CLASSB_WDT_PER</a>.</p>
<dl class="section note"><dt>Note:</dt><dd>The WDT should be left enabled by this test and be active at all times. There are a number of Class B tests that can potentially take longer time than a WDT, see for example <a class="el" href="group__classb__crc.html">CRC Tests</a>. If this was the case, a possible solution would be to increase the WDT period before the Class B test and decrease it again afterwards. </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="member-group"></a>
Configuration settings</h2></td></tr>
<tr class="memitem:ga161d302a8184a4b2f06283e415a28c5d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__wdt.html#ga161d302a8184a4b2f06283e415a28c5d">CLASSB_WDT_WPER</a>&#160;&#160;&#160;WDT_WPER_500CLK_gc</td></tr>
<tr class="memdesc:ga161d302a8184a4b2f06283e415a28c5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the closed period, where WDT cannot be reset.  <a href="#ga161d302a8184a4b2f06283e415a28c5d"></a><br/></td></tr>
<tr class="memitem:gaf28ab763bb273114496098b3fa2b5fa5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__wdt.html#gaf28ab763bb273114496098b3fa2b5fa5">CLASSB_WDT_PER</a>&#160;&#160;&#160;WDT_PER_250CLK_gc</td></tr>
<tr class="memdesc:gaf28ab763bb273114496098b3fa2b5fa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the open period, where WDT has to be reset.  <a href="#gaf28ab763bb273114496098b3fa2b5fa5"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="member-group"></a>
Class B Test</h2></td></tr>
<tr class="memitem:ga802c2e3817ea15aec36a0930dc3dbe4f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__wdt.html#ga802c2e3817ea15aec36a0930dc3dbe4f">classb_wdt_test</a> (void)</td></tr>
<tr class="memdesc:ga802c2e3817ea15aec36a0930dc3dbe4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the watchdog timer (WDT) self-diagnostic test.  <a href="#ga802c2e3817ea15aec36a0930dc3dbe4f"></a><br/></td></tr>
</table>
<hr/><h2>Macro Definition Documentation</h2>
<a class="anchor" id="ga161d302a8184a4b2f06283e415a28c5d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLASSB_WDT_WPER&#160;&#160;&#160;WDT_WPER_500CLK_gc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the closed period, where WDT cannot be reset. </p>
<p>This should be given as one of the group configuration settings. The total timeout period is the sum of the open and closed periods. In order to comply with the standard, this should be at least 50% of the total period. </p>

<p>Definition at line <a class="el" href="classb__wdt__test_8h_source.html#l00105">105</a> of file <a class="el" href="classb__wdt__test_8h_source.html">classb_wdt_test.h</a>.</p>

<p>Referenced by <a class="el" href="classb__wdt__test_8c_source.html#l00107">classb_wdt_test()</a>.</p>

</div>
</div>
<a class="anchor" id="gaf28ab763bb273114496098b3fa2b5fa5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLASSB_WDT_PER&#160;&#160;&#160;WDT_PER_250CLK_gc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the open period, where WDT has to be reset. </p>
<p>This should be given as one of the group configuration settings. The total timeout period is the sum of the open and closed periods. In order to comply with the standard, this should be no greater than than 50% of the total period. </p>

<p>Definition at line <a class="el" href="classb__wdt__test_8h_source.html#l00112">112</a> of file <a class="el" href="classb__wdt__test_8h_source.html">classb_wdt_test.h</a>.</p>

<p>Referenced by <a class="el" href="classb__wdt__test_8c_source.html#l00107">classb_wdt_test()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga802c2e3817ea15aec36a0930dc3dbe4f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void classb_wdt_test </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is the watchdog timer (WDT) self-diagnostic test. </p>
<p>Basically this functions tests the following:</p>
<ol type="1">
<li>WDT issues a system reset after timeout.</li>
<li>WDT timing and that it can be reset.</li>
<li>WDT issues a system reset if it is untimely reset (WDT window mode). If any of these tests should fail, <a class="el" href="group__error__handler.html#ga7116805ebcadd937b4da657c8928514c">CLASSB_ERROR_HANDLER_WDT()</a> would be called. By default the device will simply hang.</li>
</ol>
<p>The expected (error-free) execution flow is as follows:</p>
<ol type="1">
<li>Power-on or external reset has occurred.</li>
<li>Check that WDT can issue a system reset. Set test state 1 and system reset.</li>
<li>Check that WDT can be reset. Set test state 2 and system reset.</li>
<li>Check that window mode works correctly. Set test state 3 and system reset.</li>
<li>Set up WDT in windows mode with periods CLASSB_WDT_WPER and CLASSB_WDT_PER. Set test state "ok" and continue to main().</li>
</ol>
<p>The real time counter (RTC) is used as an independent clock source, which is used to check the timing of the oscillator used by the WDT.</p>
<p>The reset cause is used to decide which actions to take. The user can configure how to process a reset caused by the watchdog when the test is in the "ok" state, i.e. <a class="el" href="group__error__handler.html#gafc91494ced509f11776b833ca6176730">CLASSB_ACTIONS_WDT_RUNTIME_FAILURE()</a>, or what to do for brown-out or software reset, i.e. <a class="el" href="group__error__handler.html#gab5e1e551d29d6d8e3d436fea0e2b51f2">CLASSB_ACTIONS_WDT_OTHER_FAILURE()</a>.</p>
<dl class="section note"><dt>Note:</dt><dd>This test is executed before the main function. The method to achieve this depends on the specific compiler that is used. </dd></dl>

<p>Definition at line <a class="el" href="classb__wdt__test_8c_source.html#l00107">107</a> of file <a class="el" href="classb__wdt__test_8c_source.html">classb_wdt_test.c</a>.</p>

<p>References <a class="el" href="error__handler_8h_source.html#l00139">CLASSB_ACTIONS_WDT_OTHER_FAILURE</a>, <a class="el" href="error__handler_8h_source.html#l00122">CLASSB_ACTIONS_WDT_RUNTIME_FAILURE</a>, <a class="el" href="analog_2_user_application_8c_source.html#l00056">classb_error</a>, <a class="el" href="error__handler_8h_source.html#l00099">CLASSB_ERROR_HANDLER_WDT</a>, <a class="el" href="classb__wdt__test_8h_source.html#l00112">CLASSB_WDT_PER</a>, and <a class="el" href="classb__wdt__test_8h_source.html#l00105">CLASSB_WDT_WPER</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
