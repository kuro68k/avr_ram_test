<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Xmega IEC60730 Class B Library: Internal SRAM Test</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="XMEGA-3D-block-diagram.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xmega IEC60730 Class B Library
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__classb__sram.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Internal SRAM Test</div>  </div>
</div><!--header-->
<div class="contents">
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>This self-diagnostic test checks the internal SRAM memory for coupling faults. </p>
<p>The test <a class="el" href="group__classb__sram.html#ga2b1db41a922911927aec3d259a4f6938">classb_sram_test()</a> divides the internal SRAM into <a class="el" href="group__classb__sram.html#gaf77d30e5b631fd8e5a55feac5919422b">CLASSB_NSECS</a> sections that are tested in turns with a March algorithm (see <a class="el" href="group__classb__sram.html#marchx">March X</a>). The simplest behavior of the test is when there is no overlap between memory sections. In this case all sections have the same size, except possibly the last one (see <a class="el" href="group__classb__sram.html#gaf77d30e5b631fd8e5a55feac5919422b">CLASSB_NSECS</a>). The first memory section (referred to as the buffer) is reserved: it is used by the test to store the content of the other sections while they are being tested (for more details see <a class="el" href="group__classb__sram.html#ga15e3135fff2e7c53627c345b18c94973">classb_buffer</a>).</p>
<p>If there is overlap (see <a class="el" href="group__classb__sram.html#ga4f2489e262643c7425b2ca20fc14b2b3">CLASSB_OVERLAP</a>), every time a memory section is tested a part of the previous section is tested as well. Note that this does not apply to the buffer, since it is the first section. The size of the buffer is then expanded with respect to the previous case. Further, the size of the second section is decreased correspondingly.</p>
<p>If there should be an error in internal SRAM the error handler <a class="el" href="group__error__handler.html#ga13ae8d3bc99130bbf5dac2171b1b8a25">CLASSB_ERROR_HANDLER_SRAM()</a> would be called.</p>
<dl class="section note"><dt>Note:</dt><dd>Interrupts must be disabled during this test.</dd></dl>
<h1><a class="anchor" id="marchx"></a>
March X</h1>
<p>The chosen algorithm is <em>March X</em>. This consists on the following steps: </p>
<p class="formulaDsp">
\[ \Updownarrow (w_\textbf{D}); \Uparrow(r_\textbf{D}, w_\bar{\textbf{D}}); \Downarrow (r_\bar{\textbf{D}}, w_\textbf{D}); \Updownarrow (r_\textbf{D}) \;,\]
</p>
<p> where \(w\) denotes a write operation, \(r\) denotes a read operation, \(\textbf{D}\) is any data background, \(\bar{\textbf{D}}\) is the complement of \(\textbf{D}\) and the arrows refer to the addressing order. In our implementation we have chosen \(\textbf{D} = \text{0x00}\).</p>
<p>Under the restricted coupling faults (CFs) model, the interleaved organization of the memory in XMEGA avoids any kind of intra-word CFs. However, in order to detect some intra-word CFs that are not considered by this fault model, we have included the following optional march element: </p>
<p class="formulaDsp">
\[ \Updownarrow (w_\textbf{D_0}, r_\textbf{D_0} \ldots w_\textbf{D_d}, r_\textbf{D_d}) \;,\]
</p>
<p> where the background sequence is \(\text{{0x00, 0xFF, 0x55, 0xAA, 0x33, 0xCC, 0x0F, 0xF0}}\). This intra-word test is only executed if <a class="el" href="group__classb__sram.html#ga51a53f2d92447104ad1afd3e6ea1045a">CLASSB_SRAM_INTRAWORD_TEST</a> is defined. The elements that correspond to the first two data backgrounds are redundant because the first part of the test includes them. This optional test will detect all intra-word state CFs considered by the unrestricted CF model. </p>
<table class="memberdecls">
<tr class="memitem:ga15e3135fff2e7c53627c345b18c94973"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__sram.html#ga15e3135fff2e7c53627c345b18c94973">classb_buffer</a> [CLASSB_SEC_SIZE+CLASSB_OVERLAP_SIZE]</td></tr>
<tr class="memdesc:ga15e3135fff2e7c53627c345b18c94973"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer of SRAM memory that is used to store the information from sections that are tested.  <a href="#ga15e3135fff2e7c53627c345b18c94973"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="member-group"></a>
Configuration settings</h2></td></tr>
<tr class="memitem:gaf77d30e5b631fd8e5a55feac5919422b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__sram.html#gaf77d30e5b631fd8e5a55feac5919422b">CLASSB_NSECS</a>&#160;&#160;&#160;8</td></tr>
<tr class="memdesc:gaf77d30e5b631fd8e5a55feac5919422b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of sections the SRAM is divided into for testing.  <a href="#gaf77d30e5b631fd8e5a55feac5919422b"></a><br/></td></tr>
<tr class="memitem:ga4f2489e262643c7425b2ca20fc14b2b3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__sram.html#ga4f2489e262643c7425b2ca20fc14b2b3">CLASSB_OVERLAP</a>&#160;&#160;&#160;25UL</td></tr>
<tr class="memdesc:ga4f2489e262643c7425b2ca20fc14b2b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Overlap between memory sections (in % of <code>CLASSB_SEC_SIZE</code>).  <a href="#ga4f2489e262643c7425b2ca20fc14b2b3"></a><br/></td></tr>
<tr class="memitem:ga51a53f2d92447104ad1afd3e6ea1045a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__sram.html#ga51a53f2d92447104ad1afd3e6ea1045a">CLASSB_SRAM_INTRAWORD_TEST</a></td></tr>
<tr class="memdesc:ga51a53f2d92447104ad1afd3e6ea1045a"><td class="mdescLeft">&#160;</td><td class="mdescRight">If defined an intra-word test will be added after the inter-word test.  <a href="#ga51a53f2d92447104ad1afd3e6ea1045a"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="member-group"></a>
Class B Test</h2></td></tr>
<tr class="memitem:ga2b1db41a922911927aec3d259a4f6938"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__classb__sram.html#ga2b1db41a922911927aec3d259a4f6938">classb_sram_test</a> (void)</td></tr>
<tr class="memdesc:ga2b1db41a922911927aec3d259a4f6938"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function executes March X test for a memory section at a time.  <a href="#ga2b1db41a922911927aec3d259a4f6938"></a><br/></td></tr>
</table>
<hr/><h2>Macro Definition Documentation</h2>
<a class="anchor" id="gaf77d30e5b631fd8e5a55feac5919422b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLASSB_NSECS&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Number of sections the SRAM is divided into for testing. </p>
<p>It is advisable that <code>INTERNAL_SRAM_SIZE</code> is divisible by the number of sections and, therefore, recommended values are 2, 4, 8, 16, etc. Otherwise an extra section will be added with the remainder of the division as size. Note that the higher the number of sections the smaller the size of <a class="el" href="group__classb__sram.html#ga15e3135fff2e7c53627c345b18c94973">classb_buffer</a>, i.e. the section of memory that is reserved for the test) and the faster each partial test is completed. </p>

<p>Definition at line <a class="el" href="classb__sram_8h_source.html#l00109">109</a> of file <a class="el" href="classb__sram_8h_source.html">classb_sram.h</a>.</p>

<p>Referenced by <a class="el" href="classb__sram_8c_source.html#l00122">classb_sram_test()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4f2489e262643c7425b2ca20fc14b2b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLASSB_OVERLAP&#160;&#160;&#160;25UL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Overlap between memory sections (in % of <code>CLASSB_SEC_SIZE</code>). </p>
<p>This should be an unsigned long, i.e. &lt;val&gt;UL. </p>

<p>Definition at line <a class="el" href="classb__sram_8h_source.html#l00116">116</a> of file <a class="el" href="classb__sram_8h_source.html">classb_sram.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga51a53f2d92447104ad1afd3e6ea1045a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLASSB_SRAM_INTRAWORD_TEST</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If defined an intra-word test will be added after the inter-word test. </p>
<p>Given the layout of the memory, the probability of intra-word coupling faults is greatly diminished. However, for extra safety the test can be expanded to check some intra word coupling faults. </p>

<p>Definition at line <a class="el" href="classb__sram_8h_source.html#l00124">124</a> of file <a class="el" href="classb__sram_8h_source.html">classb_sram.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga2b1db41a922911927aec3d259a4f6938"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void classb_sram_test </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function executes March X test for a memory section at a time. </p>
<p>The test behaves as follows for a general section:</p>
<ul>
<li>The size of the section is <code>CLASSB_SEC_SIZE</code>.</li>
<li>In order to have overlap between sections, the total number of bytes to be tested is <code>CLASSB_SEC_SIZE + CLASSB_OVERLAP_SIZE</code>.</li>
<li>The algorithm is set to start <code>CLASSB_OVERLAP_SIZE</code> bytes before the start of the current section, thus overlapping <code>CLASSB_OVERLAP_SIZE</code> bytes with the previous section.</li>
</ul>
<p>Special cases of memory sections are:</p>
<ul>
<li>The first section to test is the buffer segment, which starts at <code>INTERNAL_SRAM_START</code> and ends at <code>CLASSB_SEC_SIZE + CLASSB_OVERLAP_SIZE</code>. In this case there is no previous segment, so no overlap is necessary. The total number of bytes tested is then the size of the buffer.</li>
<li>The second section to test is the first "data" memory section (i.e. the one after the buffer). The size of this section is <code> CLASSB_SEC_SIZE - CLASSB_OVERLAP_SIZE</code> (i.e. the size of this section was reduced in <code>CLASSB_OVERLAP_SIZE</code> bytes in order to expand the buffer by the same size). The test starts <code>CLASSB_OVERLAP_SIZE</code> bytes before the beginning of the section, and the total number of bytes tested is then <code>CLASSB_SEC_SIZE</code>.</li>
<li>The "remainder" segment, if any. This section has a size of <code>CLASSB_SEC_REM</code>, so the total number of bytes will be <code>CLASSB_SEC_REM + CLASSB_OVERLAP_SIZE</code>. </li>
</ul>

<p>Definition at line <a class="el" href="classb__sram_8c_source.html#l00122">122</a> of file <a class="el" href="classb__sram_8c_source.html">classb_sram.c</a>.</p>

<p>References <a class="el" href="classb__sram_8h_source.html#l00109">CLASSB_NSECS</a>.</p>

<p>Referenced by <a class="el" href="sram_2_user_application_8c_source.html#l00111">main()</a>.</p>

<p><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="group__classb__sram_ga2b1db41a922911927aec3d259a4f6938_icgraph.png" border="0" usemap="#group__classb__sram_ga2b1db41a922911927aec3d259a4f6938_icgraph" alt=""/></div>
<map name="group__classb__sram_ga2b1db41a922911927aec3d259a4f6938_icgraph" id="group__classb__sram_ga2b1db41a922911927aec3d259a4f6938_icgraph">
<area shape="rect" id="node3" href="sram_2_user_application_8c.html#a840291bc02cba5474a4cb46a9b9566fe" title="Main entry point of the application. Sets up board hardware, and waits until an error has occurred..." alt="" coords="179,5,229,32"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga15e3135fff2e7c53627c345b18c94973"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t classb_buffer[CLASSB_SEC_SIZE+CLASSB_OVERLAP_SIZE]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Buffer of SRAM memory that is used to store the information from sections that are tested. </p>
<p>The buffer is placed in the beginning of SRAM (see <code>INTERNAL_SRAM_START</code>). The size in bytes should be <code>INTERNAL_SRAM_SIZE/CLASSB_NSECS+CLASSB_OVERLAP_SIZE</code>. As an example, let us suppose the device has <code>INTERNAL_SRAM_SIZE=4096</code> Bytes of SRAM, <a class="el" href="group__classb__sram.html#gaf77d30e5b631fd8e5a55feac5919422b">CLASSB_NSECS</a> = 8 and <a class="el" href="group__classb__sram.html#ga4f2489e262643c7425b2ca20fc14b2b3">CLASSB_OVERLAP</a>=25. Given that the number of sections is a divisor of <code>INTERNAL_SRAM_SIZE</code>, there would be in principle exactly 8 sections, each with a size of 512 Bytes. For 25% overlap we need to extend the first section (the buffer) by 128 Bytes, and the second section is shortened accordingly. Therefore, we would have to reserve 512+128=640 Bytes for the buffer.</p>
<p>The implementation depends on the compiler: For IAR it is easy because variables can be placed in a specific address using the a location pragma directive. For GCC the following steps should be followed:</p>
<ul>
<li>Firstly, it is necessary to define in <em> AVR/GNU C linker &gt; Memory settings </em> a section that starts at <code>INTERNAL_SRAM_START</code>, for example: <code> .classb_sram_buffer=0x2000</code>.</li>
<li>Secondly, the buffer variable has to be placed in that memory section. This can be done appending this to the definition of the variable: <code> __attribute__ ((section(".classb_sram_buffer")))</code>.</li>
<li>Thirdly, the <code>.data</code> section has to be moved so that there is no overlap: the start should be <code>INTERNAL_SRAM_START + buffer_size</code>. For example 640=0x280 and then we would set <code> .data=0x2280</code>. </li>
</ul>

<p>Definition at line <a class="el" href="classb__sram_8c_source.html#l00097">97</a> of file <a class="el" href="classb__sram_8c_source.html">classb_sram.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
